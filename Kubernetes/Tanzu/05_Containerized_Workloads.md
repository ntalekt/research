# Containerized Workloads

## Deploy Tanzu Kubernetes Grid Integrated edition(TKGI)

Download TKGI product

    pivnet download-product-files --product-slug='pivotal-container-service' --release-version='1.8.1' --product-file-id=739787

Download required stemcell

    pivnet download-product-files --product-slug='stemcells-ubuntu-xenial' --release-version='621.76' --product-file-id=714213

Download/install OM

    wget https://github.com/pivotal-cf/om/releases/download/6.1.0/om-linux-6.1.0
    mv om-linux-6.1.0 om
    mkdir bin
    mv om bin/
    export PATH="/home/USER-ID/workspace/bin:$PATH"

Add to your .bashrc

    export OM_USERNAME="admin"
    export OM_PASSWORD="..."

    export OM_TARGET="https://<your ops manager target url goes here>"
    export OM_SKIP_SSL_VALIDATION="true"

Upload product

    om upload-product --product pivotal-container-service-1.8.1-build.6.pivotal

Upload stemcell

    om upload-stemcell --stemcell light-bosh-stemcell-621.76-google-kvm-ubuntu-xenial-go_agent.tgz

Check available

    om available-products

Installing: <https://docs.pivotal.io/tkgi/1-8/installing-gcp.html>

### TKGI API

-   Click the Generate RSA Certificate link. When prompted enter the following wildcard domain name: \*.pks.${ENV_NAME}.${DOMAIN_NAME}
-   The API hostname should match the pattern api.pks.${ENV_NAME}.${DOMAIN_NAME}.
-   Verify that your DNS managed zone in GCP has a DNS entry for \*.pks.${ENV_NAME}.${DOMAIN_NAME}. Here are the corresponding commands using the gcloud CLI:
    gcloud dns managed-zones list
    gcloud dns record-sets list --zone ${ENV_NAME}-zone

### Plan1

Keep with the defaults: name, description, one (1) master node and three (3) worker nodes. Spread master and worker nodes across all availability zones.

### Kubernetes Cloud Provider

-   The name of the VPC network you generated with terraform can be obtained via the command:


    terraform output network_name

-   The two service account IDs were also generated by terraform, and can be obtained with:


    terraform output pks_master_node_service_account_email
    terraform output pks_worker_node_service_account_email

Finally, the subnetwork name is the output of:

    terraform output pks_services_subnet_name

Install BOSH CLI

    wget https://github.com/cloudfoundry/bosh-cli/releases/download/v6.3.1/bosh-cli-6.3.1-linux-amd64
    mv bosh-cli-6.3.1-linux-amd64 bosh
    chmod +x bosh
    mkdir bin
    mv bosh bin/
    export PATH="/home/USER-ID/bin:$PATH"

SSH to om to create ssh key

    gcloud compute ssh ubuntu@om --zone us-central1-a

    om bosh-env --ssh-private-key

## Kubernetes clusters (GCP)

## Harbor

## Application deployment

## Helm
